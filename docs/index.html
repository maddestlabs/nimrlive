<!doctypehtml><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>NimR</title><style>*{margin:0;padding:0;box-sizing:border-box}body{width:100vw;height:100vh;overflow:hidden;background:#000}.canvas-container{width:100%;height:100%;display:flex;align-items:center;justify-content:center}canvas{display:block;max-width:100%;max-height:100%;object-fit:contain}</style></head><body><div class=canvas-container><canvas class=emscripten id=canvas oncontextmenu=event.preventDefault() tabindex=-1></canvas></div><div id=status style="position:fixed;top:10px;left:10px;color:#fff;font-family:monospace;font-size:12px;background:rgba(0,0,0,.7);padding:5px 10px;border-radius:3px">Loading...</div><script>var canvas=document.getElementById("canvas");const urlParams=new URLSearchParams(window.location.search),gistId=urlParams.get("gist");let gistCode=null,moduleReady=!1,gistReady=!1;function tryLoadGist(){if(console.log("tryLoadGist called - moduleReady:",moduleReady,"gistReady:",gistReady,"hasCode:",!!gistCode),moduleReady&&gistReady&&gistCode){console.log("=== Loading code from gist ("+gistCode.length+" bytes) ===");try{if("function"==typeof Module.ccall)Module.ccall("loadCodeFromJS",null,["string"],[gistCode],{async:!0}),console.log("=== Successfully called loadCodeFromJS ==="),document.getElementById("status").textContent="";else if("function"==typeof Module._loadCodeFromJS){console.log("Using manual string allocation");var e=Module.lengthBytesUTF8(gistCode)+1,t=Module._malloc(e);Module.stringToUTF8(gistCode,t,e),Module._loadCodeFromJS(t),Module._free(t),console.log("=== Successfully loaded gist content via manual allocation ==="),document.getElementById("status").textContent=""}else console.error("Module.ccall and Module._loadCodeFromJS not available"),document.getElementById("status").innerHTML='<span style="color: #ff6b6b;">Gist load failed</span>'}catch(e){console.error("Error loading gist code:",e),document.getElementById("status").innerHTML='<span style="color: #ff6b6b;">Error loading gist</span>'}}}function resizeCanvas(){var e,t,o=window.innerWidth,n=window.innerHeight,s=canvas.width/canvas.height;o/n>s?(t=n,e=n*s):(e=o,t=o/s),canvas.style.width=e+"px",canvas.style.height=t+"px"}function hasGistCode(){return null!==gistCode}function receiveGistCode(){return gistCode||""}gistId&&console.log("Gist parameter detected:",gistId),gistId?(document.getElementById("status").textContent="Loading gist "+gistId+"...",fetch("https://api.github.com/gists/"+gistId).then((function(e){if(!e.ok)throw new Error("Gist not found (HTTP "+e.status+")");return e.json()})).then((function(e){var t=null;for(var o in e.files)if(o.endsWith(".nim")){t=e.files[o];break}if(!t)throw new Error("No .nim file found in gist");console.log("Found Nim file in gist:",t.filename,"("+t.content.length+" bytes)"),gistCode=t.content,gistReady=!0,document.getElementById("status").textContent="Loaded "+t.filename+", starting...",tryLoadGist()})).catch((function(e){console.error("Error loading gist:",e),document.getElementById("status").innerHTML='<span style="color: #ff6b6b;">Error: '+e.message+"</span>",gistCode=null,gistReady=!0}))):gistReady=!0,console.log("Load from gist with URL parameter: ?gist=YOUR_GIST_ID"),window.addEventListener("resize",resizeCanvas),setTimeout(resizeCanvas,100);var Module={waitingForGist:!!gistId,canvas:(canvas.addEventListener("webglcontextlost",(function(e){alert("WebGL context lost. Please reload the page."),e.preventDefault()}),!1),canvas),printErr:function(e){console.error(e),document.getElementById("status").innerHTML='<span style="color: #ff6b6b;">'+e+"</span>"},print:function(e){console.log(e)},postRun:[resizeCanvas],onRuntimeInitialized:function(){if(moduleReady=!0,console.log("Module runtime initialized"),gistId&&"function"==typeof Module._setWaitingForGist){console.log("Setting wait flag for gist before app init");try{Module._setWaitingForGist()}catch(e){console.error("Error calling setWaitingForGist:",e)}}gistId?tryLoadGist():document.getElementById("status").textContent="Ready - Load a gist with ?gist=YOUR_GIST_ID"},setStatus:function(e){},totalDependencies:0,monitorRunDependencies:function(e){}};window.onerror=function(e){console.error("Error:",e)}</script><script async src=index.js></script></body></html>